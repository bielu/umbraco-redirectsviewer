<div ng-controller="Our.Umbraco.RedirectsViewer.SettingsController as vm" class="form-horizontal">
    <umb-box>
        <umb-box-header title-key="redirectsviewer_headerText">

        </umb-box-header>
        <umb-box-content>
            <p><localize key="redirectsviewer_introText">Redirect content app permissions can be set here, select groups that can create or delete redirects</localize></p>
        </umb-box-content>
    </umb-box>
    <umb-box ng-if="!vm.loading">
        <umb-box-header title-key="redirectsviewer_createHeading">

        </umb-box-header>
        <umb-box-content>
            <umb-property property="vm.properties.AllowPermission">
                <umb-toggle checked="vm.settings.create.allowed"
                            on-click="vm.toggleCreateAllowed()">

                </umb-toggle>
            </umb-property>
            <umb-property property="vm.properties.GroupPermissions" ng-if="vm.settings.create.allowed">
                <div class="umb-table">
                    <div class="umb-table-body">
                        <div class="umb-table-row" ng-repeat="item in vm.createGroups">
                            <div class="umb-table-cell not-fixed">
                                {{item.name}}
                            </div>
                            <div class="umb-table-cell">
                                <umb-toggle checked="item.checked"
                                            on-click="vm.toggleCreatePermission($index)">

                                </umb-toggle>
                            </div>
                        </div>
                    </div>
                </div>

            </umb-property>           
        </umb-box-content>
    </umb-box>
    <umb-box ng-if="!vm.loading">
        <umb-box-header title-key="redirectsviewer_deleteHeading">

        </umb-box-header>
        <umb-box-content>
            <umb-property property="vm.properties.AllowPermission">
                <umb-toggle checked="vm.settings.delete.allowed"
                            on-click="vm.toggleDeleteAllowed()">

                </umb-toggle>
            </umb-property>
            <umb-property property="vm.properties.GroupPermissions" ng-if="vm.settings.delete.allowed">
                <div class="umb-table">
                    <div class="umb-table-body">
                        <div class="umb-table-row" ng-repeat="item in vm.deleteGroups">
                            <div class="umb-table-cell not-fixed">
                                {{item.name}}
                            </div>
                            <div class="umb-table-cell">
                                <umb-toggle checked="item.checked"
                                            on-click="vm.toggleDeletePermission($index)">

                                </umb-toggle>
                            </div>
                        </div>
                    </div>
                </div>

            </umb-property></umb-box-content>
    </umb-box>
    <umb-box ng-if="!vm.loading">
        <umb-box-header title-key="redirectsviewer_import">

        </umb-box-header>

        <umb-box-content>
                <div class="" ng-if="statusImportItems">
                    <h4 class="usync-action-message">
                        <localize ng-if="importedCount!==total" key="redirectsviewer_inProgress">Import in Progress</localize>

                        <localize ng-if="importedCount===total" key="redirectsviewer_finished">Import Finished</localize>
                    </h4>
                    <div class="progress" style="height: 2px;">
                        <div class="bar" role="progressbar" style="width: {{vm.calcPercentage(importedCount)}}%;"
                             aria-valuenow="{{vm.calcPercentage(importedCount)}}" aria-valuemin="0"
                             aria-valuemax="100"></div>
                    </div>
                    <table class="unstyled status-table" id="redirectStatusTable">
                        <tr>
                            <th></th>
                            <th>
                                <localize key="redirectsviewer_sourceURL">Source URL</localize>
                            </th>
                            <th>
                                <localize key="redirectsviewer_targetURL">Target (URL/ID/GUID)</localize>
                            </th>
                            <th>
                                <localize key="redirectsviewer_status">Status</localize>
                            </th>
                        </tr>

                        <tr ng-repeat="item in statusImportItems" ng-class="{success: item.Item1 == 0}">
                            <td>
                                <i class="umb-healthcheck-status-icon icon-check color-green" ng-if="item.Item1 == 0"></i>
                                <i class="umb-healthcheck-status-icon icon-delete icon-delete color-red"
                                   ng-if="item.Item1 != 0"></i>
                            </td>
                            <td>{{item.Item2}}</td>
                            <td>{{item.Item3}}</td>
                            <td>
                        <span ng-if="item.Item1 == 0">
                                <localize key="redirectsviewer_created">
                                    Created
                                </localize>
                        </span>
                                <span ng-if="item.Item1 == 1">
                                <localize key="redirectsviewer_noContent">
                                       New URL does not exist in Umbraco 
                                </localize>
                                </span>

                                <span ng-if="item.Item1 == 2">
                                <localize key="redirectsviewer_exists">
                                  Error, this redirect already exists
                                </localize>
                                </span>
                                <span ng-if="item.Item1 == 3">
                                <localize key="redirectsviewer_unknown">
                                   Unknown error
                                </localize>
                                </span>
                            </td>


                        </tr>

                        </tbody>
                    </table>
                </div>
        </umb-box-content>
            <div class="umb-panel-group__details-status-action">
                <umb-button type="button"
                            button-style="success"
                            label-key="redirectsviewer_import"
                            action="vm.import()"
                            disabled="vm.working"/>
                <umb-button type="button"
                            button-style="danger"
                            ng-if="importFinished"
                            label-key="redirectsviewer_import_errors"
                            action="vm.export()"
                            disabled="vm.working"/>
            </div>
        </div>
        </umb-box>
    <div>
        <umb-button type="button"
                    button-style="success"
                    label-key="redirectsviewer_saveSettings"
                    action="vm.saveSettings()"
                    disabled="vm.working" />
    </div>
</div>